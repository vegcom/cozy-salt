# Hardened SSH configuration for production
# Generated from srv/salt/_templates/sshd_hardening.conf.jinja
# Deployed by Salt - cozy-salt project
# NOTE: Port is managed in /etc/ssh/sshd_config via file.replace (linux/config.sls)
# Do NOT set Port here to avoid dual-port binding issues

# Authentication
PasswordAuthentication no
PubkeyAuthentication yes
PermitRootLogin no
PermitEmptyPasswords no

# Security
{% if grains['os_family'] == 'Windows' %}
# Windows OpenSSH specific
KbdInteractiveAuthentication no
PubkeyAcceptedKeyTypes ssh-ed25519,ssh-rsa,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521
{% else %}
# Unix/Linux specific
ChallengeResponseAuthentication no
UsePAM yes
{% endif %}

# Session limits
MaxAuthTries 10
MaxSessions 10

# Protocol
Protocol 2

# Banner
PrintMotd yes
{% if grains['os_family'] == 'Windows' %}
Banner "C:\ProgramData\ssh\motd.txt"
{% else %}
Banner /etc/motd
{% endif %}
